#!/usr/local/node/bin/node

const { info } = require("../tools/colors");

console.log(process.argv);

class PostReceive {

    constructor (){
        this.warehourse = null;
    }

    __getWarehourseName (){
        let aPath = __filename.split("/");
        let index = aPath.findIndex( v => v === "hooks" );
        this.warehourse = aPath[index - 1];
    }

    exec (){
        this.__getWarehourseName();
        info("[info] push仓库名: %s", this.warehourse);
    }

}

{
    if ( !module.parents ){
        // const oPostReceive = new PostReceive();

        // oPostReceive.exec();

        (async () => {

            process.stdin.setEncoding('utf8');

            let s = await new Promise(resolve => {
                const chunks = [];
                process.stdin.on('readable', () => {
                    const chunk = process.stdin.read();
                    if (chunk !== null) {
                        process.stdout.write(`data: ${chunk}`);
                        chunks.push(chunk);
                    }
                });
    
                process.stdin.on('end', () => {
                    process.stdout.write('end');
                    resolve(chunks.join(""));
                });
            });

            console.log("[结果....]", s);

        })();
    }
}



