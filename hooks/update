#!/usr/local/node/bin/node

const { info, error } = require("../libs/colors");
const execSync = require("child_process").execSync;

/**
 *  @describe
 *      push代码时进行语法检测
 * 
 *      lint: 需要检查的文件类型
 *      ignore: 过滤，不需要进行检查的项目
 *      
 * 
 */


const git_gooks_env = "\
    export PATH=/usr/local/node/bin:/usr/local/sbin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin:/usr/local/bin \
    && unset GIT_DIR \
    && bash -c";

const lint = {
    ".js": {
        name: "eslint"
    }
}

const ignore = [];

const main = () => {

    console.log(process.argv);
    
    const [ , , branch, old_commit, new_commit ] = process.argv;

    const paths = process.cwd().split("/");
    const warehourse = paths[paths.length - 1].split(".git")[0];
    const username = paths[paths.length - 4];

    info("[info] 需要对用户 %s 的项目 %s, 分支: %s 进行检查...", username, warehourse, branch);
    
    if (ignore.includes(warehourse)){
        return error("[warning] 用户 %s 下的项目 %s 不需要进行语法检测", username, warehourse);
    }

    console.log(222, execSync(`${git_gooks_env} 'git diff --name-only --diff-filter=d ${old_commit} ${new_commit}'`).toString());


};


{
    if ( !module.parents ){

        (() => {
            try {
                main();
            } catch(err){
                error("[error] 发生了错误", err.toString());
            }

        })();

    }
}
